<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SurePay Agent</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="/public/images/locallogo.png" type="image/png">
    <link rel="shortcut icon" href="/public/images/locallogo.png" type="image/png">

    <link rel="stylesheet" href="/public/CSS/agent.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
</head>

<>
    <!-- Enhanced Header with Premium Design -->
    <header class="header">
        <div class="header-left">
            <div class="logo-container">
                <a href="index.html">
                    <span class="bangla-bkash">SurePay Agent</span>
                    <img src="/public/images/bkashlogo.png" alt="বিকাশ লোগো" class="logo">
                </a>
            </div>

            <nav class="nav">
                <!-- Modified: Added 'active' class to make it always appear selected -->
                <button class="nav-item dropdown premium-effect active" id="servicesButton">
                    <div class="button-content">

                </button>
                <button class="app-btn premium-effect">
                    <div class="button-content">
                        <i class="fas fa-mobile-alt"></i>
                        <span>SurePay অ্যাপ</span>
                    </div>
                </button>
            </nav>
        </div>

        <div class="header-right">
            <div class="user-section">
                <!-- Notification Icon -->
                <div class="notification-bell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">2</span>
                </div>

                <!-- Balance display popup -->
                <div class="balance-popup" id="balancePopup">
                    <div class="popup-header">
                        <span>আপনার ব্যালেন্স</span>
                    </div>
                    <div class="popup-amount">৳ 15,250.75</div>
                </div>

                <div class="user-profile premium-effect" id="userProfile">
                    <div class="user-image">
                        <img src="/public/images/user-avatar.png" alt="প্রোফাইল"
                            onerror="this.src='https://via.placeholder.com/32';this.onerror='';">
                    </div>
                    <span class="user-name">Md. Tanvir Hossain</span>
                    <i class="fas fa-eye balance-icon" id="balanceToggle" title="ব্যালেন্স দেখুন"></i>
                </div>

                <a href="javascript:void(0);" class="menu-toggle premium-effect" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- Enhanced User Dropdown -->
    <div class="user-dropdown premium-shadow" id="userDropdown">
        <div class="user-dropdown-header">
            <div class="user-info">
                <div class="dropdown-user-image">
                    <img src="/public/images/user-avatar.png" alt="প্রোফাইল"
                        onerror="this.src='https://via.placeholder.com/40';this.onerror='';">
                </div>
                <div>
                    <div class="dropdown-user-name">Md. Tanvir Hossain</div>
                    <div class="dropdown-user-phone">+880 1712-345678</div>
                </div>
            </div>
        </div>
        <div class="balance-display">
            <div class="balance-label">আপনার ব্যালেন্স</div>
            <div class="balance-amount">৳ 15,250.75</div>
        </div>
        <div class="user-dropdown-menu">
            <a href="#" class="user-dropdown-item">
                <i class="fas fa-user"></i> প্রোফাইল
            </a>
            <a href="#" class="user-dropdown-item">
                <i class="fas fa-history"></i> লেনদেন ইতিহাস
            </a>
            <a href="#" class="user-dropdown-item">
                <i class="fas fa-cog"></i> সেটিংস
            </a>
            <a href="#" class="user-dropdown-item">
                <i class="fas fa-headset"></i> হেল্প এবং সাপোর্ট
            </a>
            <a href="#" class="user-dropdown-item">
                <i class="fas fa-sign-out-alt"></i> লগ আউট
            </a>
        </div>
    </div>

    <div class="dropdown-menu premium-shadow show" id="servicesMenu">
        <div class="dropdown-header">
            <h3>Agent Service</h3>
            <p>SurePay Agent Services</p>
        </div>

        <!-- Agent Service Grid with 4 Services -->
        <div class="service-grid" id="serviceGrid">
            <!-- Row 1 -->

            <a href="cashIn.html" class="service-item premium-card">
                <div class="service-icon">
                    <img src="/public/images/icons/image1.png" alt="সেন্ড মানি">
                </div>
                <div class="service-name">Cash In</div>
            </a>

            <a href="SPToSPTransfer.html" class="service-item premium-card">
                <div class="service-icon">
                    <img src="/public/images/icons/image10.png" alt="বি টু বি ট্রান্সফার">
                </div>
                <div class="service-name">Sp to Sp Transfer</div>
            </a>
            <a href="SPToSPRequest.html" class="service-item premium-card">
                <div class="service-icon">
                    <img src="/public/images/icons/image11.png" alt="বি টু বি রিকোয়েস্ট">
                </div>
                <div class="service-name">Sp to Sp Request</div>
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <script src="/public/JS/agentJS.js"></script>
    <script src="/public/JS/agentLogoutJS.js"></script>
    <script src="/public/JS/cashInJS.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>




    <script>
        // Find this script in agent.html and update it
        // This fixes the agent login/logout flow
        document.addEventListener("DOMContentLoaded", function () {
            console.log("Agent page loaded - checking login status");

            // Get URL parameters to check if this is a fresh login
            const urlParams = new URLSearchParams(window.location.search);
            const loginFlag = urlParams.get('justLoggedIn');

            // If this is a fresh login from the login page, don't redirect
            if (loginFlag === "true") {
                console.log("Fresh login detected - skipping auth check");
                return; // Skip the authentication check
            }

            // Add a small delay to check login status (to avoid race conditions)
            setTimeout(function () {
                // Check if user is logged in as agent
                const agentData = localStorage.getItem("agentData");

                if (!agentData) {
                    console.log("No agent data found - redirecting to login");
                    window.location.href = "index.html";
                    return;
                }

                try {
                    const parsedData = JSON.parse(agentData);

                    if (!parsedData.isLoggedIn) {
                        console.log("Agent not logged in - redirecting to login");
                        window.location.href = "index.html";
                        return;
                    }

                    console.log("Agent logged in successfully:", parsedData.agentNumber);
                } catch (error) {
                    console.error("Error parsing agent data:", error);
                    window.location.href = "index.html";
                }
            }, 200); // Reduced timeout from 222200 to 200ms
        });
    </script>

    </body>

</html>